<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€çµ‚èª¿æ•´ç‰ˆ å¿˜å¹´ä¼š å¸­é †æŠ½é¸ã‚¢ãƒ—ãƒª</title>
    <style>
        /* --- CSS: ãƒ‡ã‚¶ã‚¤ãƒ³éƒ¨åˆ† --- */
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f4f7f6;
            color: #333;
            padding: 0 10px;
        }

        /* --- æŠ½é¸çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ï¼ˆå›ºå®šãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã—ã¦åˆ†é›¢ï¼‰ --- */
        #mainResultContainer {
            position: fixed;
            /* ç”»é¢ã«å›ºå®š */
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background-color: #f4f7f6;
            padding: 10px 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            height: 130px;
            /* ãƒ˜ãƒƒãƒ€ãƒ¼ã®é«˜ã•ã‚’å›ºå®š */
        }

        #mainResultContainer .container {
            /* å›ºå®šã‚³ãƒ³ãƒ†ãƒŠå†…ã®ãƒ‡ã‚¶ã‚¤ãƒ³èª¿æ•´ */
            padding: 10px 20px;
            max-width: 800px;
            width: 95%;
            margin: 0 auto;
            box-shadow: none;
        }

        #mainResult {
            font-size: 3em;
            font-weight: bold;
            color: #5cb85c;
            margin: 0 auto;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            background-color: #ffffff;
        }

        /* --- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã‚³ãƒ³ãƒ†ãƒŠ --- */
        #mainContentWrapper {
            /* å›ºå®šãƒ˜ãƒƒãƒ€ãƒ¼ã®é«˜ã•åˆ†ã€ä¸Šéƒ¨ã«ãƒãƒ¼ã‚¸ãƒ³ã‚’è¨­å®šã—ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æŠ¼ã—ä¸‹ã’ã‚‹ */
            margin-top: 130px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #mainContentWrapper .container {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            width: 95%;
            max-width: 800px;
            text-align: center;
            margin-top: 20px;
        }

        h1 {
            color: #d9534f;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        /* --- å‡ºå¸­è€…ãƒªã‚¹ãƒˆï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ --- */
        #attendeeListContainer {
            margin-top: 20px;
            text-align: left;
        }

        #attendeeTable {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 0.9em;
        }

        #attendeeTable th,
        #attendeeTable td {
            border: 1px solid #ddd;
            padding: 8px;
            vertical-align: middle;
        }

        #attendeeTable th {
            background-color: #eee;
        }

        /* æŠ½é¸ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .draw-button {
            background-color: #4CAF50;
            /* Green */
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.3s;
        }

        .draw-button:hover:not(:disabled) {
            background-color: #45a049;
        }

        .draw-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .seat-result {
            font-weight: bold;
            color: #007bff;
            /* Blue */
        }

        /* --- ç·¨é›†ã‚¨ãƒªã‚¢ï¼ˆTextareaï¼‰ --- */
        #editorHeader {
            margin-top: 40px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px 8px 0 0;
            background-color: #f0f0f0;
            cursor: pointer;
            font-weight: bold;
            text-decoration: underline;
            color: #007bff;
        }

        #editorArea {
            padding: 15px;
            border: 1px solid #ccc;
            border-top: none;
            border-radius: 0 0 8px 8px;
            background-color: #f9f9f9;
            display: none;
        }

        #attendeeData {
            width: 100%;
            min-height: 150px;
            padding: 10px;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9em;
        }

        .editor-button {
            padding: 8px 15px;
            margin-top: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .editor-button:hover {
            background-color: #0056b3;
        }
    </style>
</head>

<body>

    <div id="mainResultContainer">
        <div class="container">
            
            <div id="mainResult">ãƒªã‚¹ãƒˆã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„</div>
        </div>
    </div>

    <div id="mainContentWrapper">
        <div class="container">
            <div id="attendeeListContainer">
                <h2>ğŸ‘¤ å‡ºå¸­è€…ä¸€è¦§</h2>
                <table id="attendeeTable">
                    <thead>
                        <tr>
                            <th>éƒ¨ç½²</th>
                            <th>æ°å</th>
                            <th>ç¾åœ¨ã®å¸­é †</th>
                            <th>æŠ½é¸å®Ÿè¡Œ</th>
                        </tr>
                    </thead>
                    <tbody id="attendeeTableBody">
                    </tbody>
                </table>
            </div>

            <div id="editorHeader" onclick="toggleEditor()">
                ğŸ“ å‡ºå¸­è€…ãƒªã‚¹ãƒˆã®ç·¨é›†ãƒ»æ›´æ–° (ã‚¯ãƒªãƒƒã‚¯ã§è¡¨ç¤º/éè¡¨ç¤º)
            </div>

            <div id="editorArea">
                <p style="font-size: 0.8em; color: #555;">**å½¢å¼: éƒ¨ç½²,æ°å,å¸­ç•ªå·(ç©ºæ¬„OK)**</p>
                <textarea id="attendeeData"></textarea>
                <button class="editor-button" onclick="loadAttendees()">ãƒªã‚¹ãƒˆã‚’èª­ã¿è¾¼ã‚€/æ›´æ–°</button>
                <p id="seatInfo" style="margin-top: 10px; font-weight: bold;">ç¾åœ¨ã®æŠ½é¸æœ€å¤§å¸­æ•°: ---</p>
            </div>
        </div>
    </div>

    <script>
        // --- JavaScript: å‹•ä½œéƒ¨åˆ† ---

        let attendees = [];
        let availableSeats = [];
        let totalSeats = 0;
        let isDrawing = false;

        const resultDisplay = document.getElementById('mainResult');

        // åˆæœŸãƒ‡ãƒ¼ã‚¿ï¼ˆã‚³ãƒ¼ãƒ‰å†…ã«å†…è”µï¼‰
        const initialData = `
        å–¶æ¥­,å±±ç”°å¤ªéƒ,
        é–‹ç™º,ä½è—¤èŠ±å­,
        ç·å‹™,ç”°ä¸­ä¸€éƒ,15
        å–¶æ¥­,éˆ´æœ¨ç¾å’²,
        é–‹ç™º,é«˜æ©‹å¥å¤ª,
        ç·å‹™,å°æ—ç”±ç¾,1
        å–¶æ¥­,ä¼Šè—¤å¤§è¼”,
        é–‹ç™º,æ¸¡è¾ºã‚ã‹ã‚Š,
        ç·å‹™,å±±æœ¬æ‹“ä¹Ÿ,
        å–¶æ¥­,ä¸­æ‘é‡Œå¥ˆ,
        é–‹ç™º,åŠ è—¤é›…äºº,
        ç·å‹™,å‰ç”°æµç¾,
        çµŒç†,é’æœ¨ã•ãã‚‰,
        åºƒå ±,è¥¿æ‘æ­£äºº,
        äººäº‹,è—¤ç”°ã‚†ã‚Š,
        æŠ€è¡“,å‰ç”°ä¸€éƒ,
        ä¼ç”»,æ‘ä¸Šæ²™ç¹”,
        ç§˜æ›¸,å¤§å¡šçœŸå¸,
        æ³•å‹™,æ¾æœ¬é¦™ç¹”,
        æ¸‰å¤–,æ—å¥å¤ªéƒ,
    `.trim().split('\n').map(line => line.trim()).join('\n');
        document.getElementById('attendeeData').value = initialData;


        function toggleEditor() {
            const editorArea = document.getElementById('editorArea');
            const isHidden = editorArea.style.display === 'none' || editorArea.style.display === '';
            editorArea.style.display = isHidden ? 'block' : 'none';
        }


        function loadAttendees() {
            const data = document.getElementById('attendeeData').value;
            const lines = data.split('\n').filter(line => line.trim() !== '');

            if (lines.length === 0) {
                alert('å‡ºå¸­è€…ãƒªã‚¹ãƒˆãŒç©ºã§ã™ã€‚');
                return;
            }

            attendees = [];
            totalSeats = 0;
            const usedFixedSeats = new Set();

            lines.forEach((line, index) => {
                const parts = line.split(',').map(p => p.trim());

                let seat = parts[2] ? parseInt(parts[2], 10) : null;
                if (seat !== null && isNaN(seat)) seat = null;

                if (seat) {
                    if (seat > totalSeats) {
                        totalSeats = seat;
                    }
                    usedFixedSeats.add(seat);
                }

                attendees.push({
                    id: index,
                    department: parts[0] || 'ä¸æ˜',
                    name: parts[1] || `åç„¡ã—${index + 1}`,
                    fixedSeat: seat,
                    seat: null,
                    drawn: false,
                    isFixed: !!seat
                });
            });

            if (attendees.length > totalSeats) {
                totalSeats = attendees.length;
            }

            const allSeats = Array.from({ length: totalSeats }, (_, i) => i + 1);
            availableSeats = allSeats.filter(seat => !usedFixedSeats.has(seat));

            attendees.sort((a, b) => a.name.localeCompare(b.name, 'ja', { sensitivity: 'base' }));

            document.getElementById('seatInfo').textContent = `ç¾åœ¨ã®æŠ½é¸æœ€å¤§å¸­æ•°: ${totalSeats}å¸­ï¼ˆæŠ½é¸å¯¾è±¡: ${availableSeats.length}å¸­ï¼‰`;
            renderTable();
            resultDisplay.textContent = 'ãƒªã‚¹ãƒˆæ›´æ–°å®Œäº†ã€‚';
        }


        // --- ãƒ†ãƒ¼ãƒ–ãƒ«ã®è¡¨ç¤ºã¨æŠ½é¸ãƒœã‚¿ãƒ³ã®é…ç½® ---
        function renderTable() {
            const tbody = document.getElementById('attendeeTableBody');
            tbody.innerHTML = '';

            attendees.forEach(person => {
                const row = tbody.insertRow();

                row.insertCell().textContent = person.department;
                row.insertCell().textContent = person.name;

                const seatCell = row.insertCell();
                if (person.drawn && person.seat !== null) {
                    // æŠ½é¸æ¸ˆã¿/ç¢ºèªæ¸ˆã¿ã®å ´åˆã¯ç•ªå·ã‚’è¡¨ç¤º
                    seatCell.innerHTML = `<span class="seat-result">${person.seat}ç•ª</span>`;
                } else {
                    // ğŸŒŸ ä¿®æ­£ãƒã‚¤ãƒ³ãƒˆ: æŠ½é¸/ç¢ºèªå‰ã¯ã€å›ºå®šå¸­ã®äººã‚‚å«ã‚å…¨å“¡ã€Œæœªå®šã€ã¨è¡¨ç¤º
                    seatCell.textContent = 'æœªå®š';
                }

                const buttonCell = row.insertCell();
                const button = document.createElement('button');
                button.className = 'draw-button';
                button.textContent = person.isFixed ? 'ç¢ºèªã™ã‚‹' : 'æŠ½é¸ã™ã‚‹';
                button.disabled = person.drawn;
                button.onclick = () => startDraw(person.id);
                button.id = `drawBtn-${person.id}`;
                buttonCell.appendChild(button);
            });

            if (attendees.length === 0) {
                const row = tbody.insertRow();
                const cell = row.insertCell();
                cell.colSpan = 4;
                cell.textContent = 'ãƒªã‚¹ãƒˆã‚’èª­ã¿è¾¼ã‚“ã§ãã ã•ã„ã€‚';
            }
        }


        // --- æŠ½é¸ãƒ­ã‚¸ãƒƒã‚¯ ---
        function startDraw(personId) {
            if (isDrawing) return;

            const person = attendees.find(p => p.id === personId);
            if (!person || person.drawn) return;

            isDrawing = true;
            document.getElementById(`drawBtn-${personId}`).disabled = true;

            let drawnNumber;

            if (person.isFixed) {
                drawnNumber = person.fixedSeat;
            } else {
                if (availableSeats.length === 0) {
                    resultDisplay.textContent = 'ğŸ‰ æŠ½é¸çµ‚äº†ï¼ç©ºå¸­ãŒã‚ã‚Šã¾ã›ã‚“ã€‚';
                    isDrawing = false;
                    renderTable();
                    return;
                }

                const randomIndex = Math.floor(Math.random() * availableSeats.length);
                drawnNumber = availableSeats[randomIndex];

                availableSeats.splice(randomIndex, 1);
            }

            displayResult(drawnNumber, personId);
        }

        // --- æŠ½é¸çµæœã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãƒ‡ãƒ¼ã‚¿æ›´æ–° ---
        function displayResult(number, personId) {
            let count = 0;
            const person = attendees.find(p => p.id === personId);

            document.querySelectorAll('.draw-button').forEach(btn => btn.disabled = true);

            const interval = setInterval(() => {
                if (count < 15) {
                    const dummyNumber = Math.floor(Math.random() * totalSeats) + 1;
                    resultDisplay.textContent = `${person.isFixed ? 'ç¢ºèªä¸­' : 'æŠ½é¸ä¸­'}... ${dummyNumber}ç•ª`;
                    count++;
                } else {
                    clearInterval(interval);

                    resultDisplay.textContent = `${person.name} ã•ã‚“ã®å¸­ã¯ ${number}ç•ª ã«æ±ºå®šï¼`;

                    person.seat = number;
                    person.drawn = true;

                    renderTable();

                    document.querySelectorAll('.draw-button').forEach(btn => {
                        const id = parseInt(btn.id.replace('drawBtn-', ''), 10);
                        if (!attendees.find(p => p.id === id).drawn) {
                            btn.disabled = false;
                        }
                    });

                    isDrawing = false;

                    if (attendees.every(a => a.drawn)) {
                        resultDisplay.textContent = 'ğŸ‰ å…¨å“¡åˆ†ã®å¸­ãŒæ±ºã¾ã‚Šã¾ã—ãŸï¼ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼';
                    }
                }
            }, 80);
        }

        // --- åˆæœŸå®Ÿè¡Œ ---
        window.onload = function () {
            loadAttendees();
        };
    </script>

</body>

</html>