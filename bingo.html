<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ“ãƒ³ã‚´æŠ½é¸ãƒšãƒ¼ã‚¸</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #f4f7f6;
            color: #333;
            padding: 20px 10px;
        }

        .container {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            width: 95%;
            max-width: 800px;
            text-align: center;
        }

        h1 {
            color: #f39c12;
            /* ãƒ“ãƒ³ã‚´ã‚«ãƒ©ãƒ¼ */
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        /* --- æŠ½é¸çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ --- */
        #resultDisplay {
            font-size: 5em;
            font-weight: bold;
            color: #d9534f;
            /* èµ¤è‰²ã§å¼·èª¿ */
            margin: 10px 0 30px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid #f39c12;
            padding: 10px;
            border-radius: 10px;
            background-color: #fff8e1;
            /* è–„ã„é»„è‰² */
        }

        .draw-button {
            background-color: #f39c12;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.5em;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .draw-button:hover:not(:disabled) {
            background-color: #e67e22;
        }

        .draw-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        /* --- æŠ½é¸å±¥æ­´ã‚¨ãƒªã‚¢ --- */
        #historyContainer {
            margin-top: 40px;
            text-align: left;
        }

        #historyHeader {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
            border-bottom: 2px solid #ddd;
            padding-bottom: 5px;
        }

        #historyList {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            background-color: #fefefe;
            min-height: 50px;
        }

        .drawn-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 35px;
            height: 35px;
            background-color: #d9534f;
            color: white;
            border-radius: 50%;
            font-weight: bold;
            font-size: 0.9em;
        }

        /* è¨­å®šãƒšãƒ¼ã‚¸ã¸ã®ãƒªãƒ³ã‚¯ãƒœã‚¿ãƒ³ */
        .settings-link {
            display: block;
            margin-top: 30px;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
        }

        #rangeInfo {
            margin-bottom: 15px;
            font-weight: bold;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>ğŸ‰ å¿˜å¹´ä¼š ãƒ“ãƒ³ã‚´æŠ½é¸</h1>

        <div id="rangeInfo"></div>

        <div id="resultDisplay">---</div>

        <button id="drawBtn" class="draw-button" onclick="startDraw()">æ¬¡ã®ç•ªå·ã‚’æŠ½é¸ï¼</button>

        <div id="historyContainer">
            <div id="historyHeader">ğŸ”¢ æŠ½é¸å±¥æ­´ï¼ˆæœ€æ–°ãŒå·¦ä¸Šï¼‰</div>
            <div id="historyList">
            </div>
        </div>

        <a href="settings.html" class="settings-link" style="background-color: #007bff;">
            ğŸ“ ãƒ“ãƒ³ã‚´è¨­å®šã‚’å¤‰æ›´ã™ã‚‹
        </a>
        <a href="index.html" class="settings-link" style="background-color: #5cb85c;">
            ğŸ¯ å¸­é †æŠ½é¸ãƒšãƒ¼ã‚¸ã¸æˆ»ã‚‹
        </a>
    </div>

    <script>
        let minNumber = 1;
        let maxNumber = 75;
        let availableNumbers = [];
        let drawnNumbers = [];
        let isDrawing = false;

        const resultDisplay = document.getElementById('resultDisplay');
        const historyList = document.getElementById('historyList');
        const drawBtn = document.getElementById('drawBtn');

        // --- ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«è¨­å®šã¨å±¥æ­´ã‚’èª­ã¿è¾¼ã‚€ ---
        window.onload = function () {
            loadSettings();
            loadHistory();
            updateDisplay();
        };

        function loadSettings() {
            // è¨­å®šã‚’LocalStorageã‹ã‚‰èª­ã¿è¾¼ã‚€
            const storedMin = parseInt(localStorage.getItem('bingoMin'), 10);
            const storedMax = parseInt(localStorage.getItem('bingoMax'), 10);

            if (!isNaN(storedMin) && storedMin > 0) minNumber = storedMin;
            if (!isNaN(storedMax) && storedMax > 0) maxNumber = storedMax;

            if (minNumber >= maxNumber) {
                minNumber = 1;
                maxNumber = 75;
                alert('è¨­å®šã•ã‚ŒãŸç¯„å›²ãŒä¸æ­£ã§ã™ã€‚åˆæœŸå€¤(1ã€œ75)ã«æˆ»ã—ã¾ã™ã€‚');
            }

            document.getElementById('rangeInfo').textContent = `æŠ½é¸ç¯„å›²: ${minNumber}ç•ª ã€œ ${maxNumber}ç•ª`;
        }

        function loadHistory() {
            const storedHistory = localStorage.getItem('bingoDrawnNumbers');
            if (storedHistory) {
                drawnNumbers = JSON.parse(storedHistory);
            }

            // æŠ½é¸å¯èƒ½ãªç•ªå·ã®ãƒªã‚¹ãƒˆã‚’ç”Ÿæˆ
            const allNumbers = Array.from({ length: maxNumber - minNumber + 1 }, (_, i) => i + minNumber);
            availableNumbers = allNumbers.filter(num => !drawnNumbers.includes(num));
        }

        function saveHistory() {
            localStorage.setItem('bingoDrawnNumbers', JSON.stringify(drawnNumbers));
        }

        function updateDisplay() {
            // å±¥æ­´ãƒªã‚¹ãƒˆã®è¡¨ç¤ºã‚’æ›´æ–°
            historyList.innerHTML = '';
            // æœ€æ–°ã®ç•ªå·ãŒå·¦ä¸Šã«æ¥ã‚‹ã‚ˆã†ã«ã€é…åˆ—ã‚’é€†é †ã«ã—ã¦è¡¨ç¤º
            [...drawnNumbers].reverse().forEach(num => {
                const span = document.createElement('div');
                span.className = 'drawn-number';
                span.textContent = num;
                historyList.appendChild(span);
            });

            // æŠ½é¸ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’æ›´æ–°
            if (availableNumbers.length === 0) {
                drawBtn.disabled = true;
                drawBtn.textContent = 'ğŸ‰ å…¨ã¦æŠ½é¸æ¸ˆã¿ã§ã™ ğŸ‰';
                if (drawnNumbers.length > 0) {
                    resultDisplay.textContent = drawnNumbers[drawnNumbers.length - 1];
                } else {
                    resultDisplay.textContent = '---';
                }
            } else {
                drawBtn.disabled = isDrawing;
                drawBtn.textContent = 'æ¬¡ã®ç•ªå·ã‚’æŠ½é¸ï¼';
            }
        }

        // --- æŠ½é¸ãƒ­ã‚¸ãƒƒã‚¯ ---
        function startDraw() {
            if (isDrawing || availableNumbers.length === 0) return;

            isDrawing = true;
            drawBtn.disabled = true;
            drawBtn.textContent = 'æŠ½é¸ä¸­...';

            // ãƒ©ãƒ³ãƒ€ãƒ ãªç•ªå·ã‚’é¸æŠ
            const randomIndex = Math.floor(Math.random() * availableNumbers.length);
            const drawnNumber = availableNumbers[randomIndex];

            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤º
            displayResult(drawnNumber);

            // ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤ã€å±¥æ­´ã«è¿½åŠ 
            availableNumbers.splice(randomIndex, 1);
            drawnNumbers.push(drawnNumber);

            saveHistory();
        }

        // --- æŠ½é¸çµæœã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãƒ‡ãƒ¼ã‚¿æ›´æ–° ---
        function displayResult(number) {
            let count = 0;

            const interval = setInterval(() => {
                if (count < 20) {
                    const dummyNumber = availableNumbers.length > 0
                        ? availableNumbers[Math.floor(Math.random() * availableNumbers.length)]
                        : Math.floor(Math.random() * (maxNumber - minNumber + 1)) + minNumber;

                    resultDisplay.textContent = dummyNumber;
                    count++;
                } else {
                    clearInterval(interval);

                    // æœ€çµ‚çµæœã‚’è¡¨ç¤º
                    resultDisplay.textContent = number;

                    isDrawing = false;
                    updateDisplay();
                }
            }, 50);
        }
    </script>

</body>

</html>